{% set cssHash = craft.twigpack.getModuleHash('/css/app.css', 'legacy') %}

{% if cookies.get('critical-css') == cssHash %}
  {{ craft.twigpack.includeCssModule('/css/app.css', false) }}
{% else %}
  {% do craft.cookies.setSecure('critical-css', '{{ cssHash }}', now | date_modify("+7 days").timestamp, '/', '', '', true) %}

  <!-- Critical css -->
  {# https://nystudio107.com/docs/twigpack/#craft-twigpack-includecriticalcsstags #}
  {{ craft.twigpack.includeCriticalCssTags() }}

  {{ craft.twigpack.includeCssModule('/css/app.css', true) }}
{% endif %}
